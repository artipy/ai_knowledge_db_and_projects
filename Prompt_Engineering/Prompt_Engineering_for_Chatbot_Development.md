# Prompt Engineering для разработки чатботов

## Введение

При разработке чатботов критически важно правильно выстраивать промпты, так как предугадать вопросы пользователей и способы использования чата — задача непростая. Все это решается через применение правил промпт-инжиниринга и выстраивание ограничений с помощью **system role**.

> **Связанные материалы:**
> - [[Prompt_Engineering_Best_Practices]] — базовые принципы промпт-инжиниринга
> - [[Chat_Roles_and_Multi_Turn_Conversations]] — работа с ролями в диалогах
> - [[Working_with_OpenAI_API_in_Python]] — практическая реализация на Python

---

## Основы создания чатбота

### 1. Определение роли и цели чатбота

Первое, что необходимо при создании чатбота — указать его **роль** или **цель**. Это позволяет модели понять контекст и ожидаемые вопросы пользователей.

**Пример:**
```python
sys_prompt = "Ты финансовый советник."
usr_prompt = "Кто ты?"
```

**Результат:** Модель представится как финансовый советник и опишет свои возможности в этой области.

---

### 2. Определение поведения модели

Необходимо точно и ясно объяснить поведение модели, учитывая:
- **Целевую аудиторию** — для кого предназначен чатбот
- **Тональность ответов** — формальная, дружеская, экспертная
- **Длину ответов** — краткие или развернутые
- **Структуру ответов** — списки, абзацы, таблицы

**Пример настройки тональности:**
```python
sys_prompt = """Ты чатбот, который отвечает на финансовые вопросы.
Ты должен быть точным, формальным и объективным."""

usr_prompt = "Расскажи мне что такое криптовалюта"
```

**Результат:** Модель даст формальный, структурированный ответ с точными определениями и характеристиками криптовалют.

---

### 3. Установка условий и ограничений

Чатбот должен работать в рамках своей специализации и вежливо отказываться от вопросов вне области компетенции.

**Пример с ограничениями:**
```python
sys_prompt = """Ты чатбот, который отвечает на финансовые вопросы.
Ты работаешь по следующим правилам:
- Ты должен отвечать точно, формально и объективно
- Если вопрос касается финансовой сферы, ты отвечаешь самым наилучшим образом
- Если вопрос не касается финансовой сферы, ты должен вежливо отказаться отвечать на вопрос"""

usr_prompt = "Какая погода сегодня?"
```

**Результат:**
> "Извините, но я не могу предоставить информацию о погоде. Рекомендую воспользоваться специализированными метеорологическими сервисами. Если у вас есть вопросы по финансовой тематике, я с радостью помогу."

---

## Role-Playing Prompts

**Ролевые промпты** — важный аспект разработки чатботов. При указании роли в system prompt модель перенимает:
- Тональность речи
- Словарный запас
- Поведенческие паттерны

> **Важно:** Указание роли не может полностью покрыть настройку чатбота. Используйте дополнительные блоки промпта для детальной донастройки поведения через system prompt.

**Примеры ролей:**
- "Ты опытный финансовый консультант с 15-летним стажем"
- "Ты дружелюбный помощник, который объясняет сложные концепции простым языком"
- "Ты техподдержка компании, отвечающая на вопросы клиентов в вежливой и эффективной манере"

---

## Включение внешнего контекста (Incorporating External Context)

### Проблема актуальности данных

Модели обучаются на данных определенного периода времени. Если модель обучена на данных до 2020 года, она не будет знать информацию из 2023 года. Кроме того, модель **не имеет доступа к приватной информации** о конкретных компаниях, продуктах или внутренних процессах.

### Решения

#### 1. Синтетический диалог (User-Assistant пары)

Можно предоставить контекст через предварительные пары user-assistant сообщений:

```python
messages = [
    {'role': 'system', 'content': 'Ты чат-бот консультант покупателей...'},
    {'role': 'user', 'content': 'Какие услуги предоставляет ваша компания?'},
    {'role': 'assistant', 'content': 'Мы предоставляем услуги по разработке web приложений, мобильных приложений и разработке кастомного ПО'},
    {'role': 'user', 'content': 'Сколько всего услуг вы предоставляете?'}
]
```

#### 2. Встраивание контекста в System Prompt

Более эффективный способ — включить информацию непосредственно в system prompt:

```python
service_list = '''ABC Tech Solutions, лидирующая IT компания, которая предоставляет ряд услуг:
- Разработка приложений
- Разработка мобильных приложений
- Разработка кастомного ПО'''

sys_prompt = f'''Ты чатбот консультант покупателей по услугам, которые предоставляет компания.
Услуги, которые предоставляет компания, обрамлены тройными обратными кавычками.
При ответе используй элегантный деловой стиль.

```{service_list}```'''

usr_prompt = "Как много услуг предоставляет компания?"
```

**Результат:** Модель точно ответит на основе предоставленной информации, а не будет полагаться на общие знания.

### ⚠️ Важное ограничение

Всегда помните про **размер контекста модели** — ограничение на количество входных и выходных токенов. Метод встраивания контекста в промпт подходит только для **небольших объемов данных**.

Для больших объемов информации используются более продвинутые практики:
- **RAG (Retrieval-Augmented Generation)** — поиск релевантной информации из базы знаний
- **Vector databases** — семантический поиск по встроенным данным
- **Function calling** — обращение к внешним API для получения актуальной информации

---

## Практический пример: полная настройка чатбота

```python
from openai import OpenAI
import os
import re

# Инициализация клиента
client = OpenAI(
    api_key=os.getenv('GROQ_TOKEN'),
    base_url=os.getenv('BASE_URL_GROQ')
)

# Функция для получения ответа
def get_response(sys_prompt, usr_prompt):
    response = client.chat.completions.create(
        model=os.getenv('GROQ_MODEL'),
        messages=[
            {'role': 'system', 'content': sys_prompt},
            {'role': 'user', 'content': usr_prompt}
        ],
        temperature=0  # Для более предсказуемых ответов
    )
    return response.choices[0].message.content

# Полный system prompt
sys_prompt = """Ты чатбот консультант для компании ABC Tech Solutions.

**Твоя роль:** Вежливый и профессиональный помощник клиентов.

**Тональность:** Элегантная, деловая, дружелюбная.

**Правила:**
- Отвечай только на вопросы о услугах компании
- Если вопрос не касается услуг, вежливо перенаправь клиента
- Предоставляй точную информацию на основе базы знаний

**Услуги компании:**
1. Разработка веб-приложений (frontend и backend)
2. Разработка мобильных приложений (iOS и Android)
3. Разработка кастомного программного обеспечения
"""

# Использование
usr_prompt = "Расскажите о ваших услугах"
response = get_response(sys_prompt, usr_prompt)
print(response)
```

---

## Чек-лист для создания чатбота

- [ ] **Определена роль** чатбота
- [ ] **Описана тональность** ответов (формальная, дружелюбная и т.д.)
- [ ] **Установлены ограничения** — что чатбот может и не может делать
- [ ] **Определена структура ответов** (длина, формат)
- [ ] **Добавлен внешний контекст** (если нужна специфическая информация)
- [ ] **Протестированы граничные случаи** (вопросы вне темы, некорректные запросы)
- [ ] **Настроена температура** модели для контроля креативности

---

## Резюме

Успешный чатбот требует:
1. **Четкого определения роли** через system prompt
2. **Детальной настройки поведения** (тональность, структура, длина)
3. **Установки границ** — что чатбот может и не может делать
4. **Включения актуального контекста** для специфических задач
5. **Тестирования** на разных типах запросов

Правильно выстроенный промпт позволяет создать чатбота, который:
- Остается в рамках своей специализации
- Отвечает в нужной тональности
- Предоставляет релевантную и актуальную информацию
- Вежливо обрабатывает неожиданные запросы

---

## Связанные материалы

- [[Prompt_Engineering_Best_Practices]] — общие принципы промпт-инжиниринга
- [[Advanced_Prompt_Engineering_Strategies]] — продвинутые техники промптинга
- [[Chat_Roles_and_Multi_Turn_Conversations]] — работа с ролями и мультишаговыми диалогами
- [[Working_with_OpenAI_API_in_Python]] — реализация на Python
- [[Exercises/06_Prompt_Engineering_for_Chatbots_Exercise|Практическое задание №6]] — отработка навыков создания специализированных чатботов на практике
